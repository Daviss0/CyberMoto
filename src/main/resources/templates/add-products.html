<!DOCTYPE html>
<html lang="en" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Adicionar Produto</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand d-flex align-items-center" href="/home">
      <img th:src="@{/cybermoto-logo.png}" alt="logo-cybermoto" width="60" height="60" class="me-2" style="margin-left: 40px" >
    </a>

    <div class="collapse navbar-collapse container d-flex justify-content-center" style="margin-left: 40px">
      <ul class="navbar-nav me-auto">
        <li class="nav-item" style="margin-right: 10px">
          <a class="nav-link" th:href="@{/home}">Início</a>
        </li>
        <li class="nav-item" sec:authorize="hasRole('ADMIN')" style="margin-right: 10px">
          <a class="nav-link" th:href="@{/admin/manage-users}">Administrar Usuários</a>
        </li>
        <li class="nav-item" sec:authorize="hasAnyRole('ADMIN', 'ESTOQUISTA')" style="margin-right: 10px">
          <a class="nav-link" th:href="@{/product/manage-products}">Administrar Produtos</a>
        </li>
      </ul>
      <span th:text="'Bem-vindo ' + ${username}">Usuário</span>
    </div>
  </div>
</nav>

<div class="container d-flex justify-content-center align-items-center"
     style="min-height: 80vh; border-top: 30px solid #ffffff; border-bottom: 30px solid #ffffff; margin-top: 40px">" >
  <form class="w-50 border p-4 rounder-shadow"
        th:action="@{/product/product-added}"
        th:object="${productForm}"
        method="post"
        enctype="multipart/form-data">

    <h1>Adicionar Produto</h1>

    <div th:if="${erro}" class="alert alert-danger text-center mb-3" th:text="${erro}"></div>

    <!-- Campos do Produto -->
    <div class="mb-3">
      <label for="productName" class="form-label">Nome do Produto:</label>
      <input type="text" th:field="*{productName}" class="form-control" id="productName" required>
    </div>

    <div class="mb-3">
      <label for="brand" class="form-label">Marca:</label>
      <input type="text" th:field="*{brand}" class="form-control" id="brand" required>
    </div>

    <div class="mb-3">
      <label for="rating" class="form-label">Avaliação:</label>
      <input type="number" th:field="*{rating}" class="form-control" id="rating"
             min="0.5" max="5.0" step="0.5" required>
    </div>

    <div class="mb-3">
      <label for="description" class="form-label">Descrição:</label>
      <textarea th:field="*{description}" id="description" class="form-control"
                rows="5" cols="50" required></textarea>
    </div>

    <div class="mb-3">
      <label for="price" class="form-label">Valor:</label>
      <div class="input-group">
        <span class="input-group-text">R$</span>
        <input type="number" th:field="*{price}" class="form-control" id="price"
               step="0.01" min="0.01" required>
      </div>
    </div>

    <div class="mb-3">
      <label for="quantity" class="form-label">Quantidade em Estoque:</label>
      <input type="number" th:field="*{quantity}" class="form-control" id="quantity"
             min="0" required>
    </div>

    <div class="mb-3">
      <label for="images" class="form-label">Imagem do Produto:</label>
      <input type="file" class="form-control" name="uploadImages" id="images" multiple accept="image/*">
    </div>

    <div class="form-check-mt-2">
      <input class="form-check-input" type="checkbox" name="isMain" id="isMain" value="true">
      <label class="form-check-label" for="isMain">Definir como imagem principal</label>
    </div>

    <input type="hidden" name="mainImageIndex" id="mainImageIndex" value="-1">
    <div id="preview" class="mb-3"></div>

    <div class="container d-flex justify-content-center">
      <button type="submit" class="btn btn-success " style="margin: 15px">Salvar</button>
      <a class="btn btn-secondary" href="/product/manage-products" style="margin: 15px" >Voltar</a>
    </div>
  </form>

</div>

<script>
  
  const imagesInput = document.getElementById('images');
  const preview = document.getElementById('preview');
  const mainImageIndexInput = document.getElementById('mainImageIndex');

  imagesInput.addEventListener('change', function(event) {
    preview.innerHTML = '';
    mainImageIndexInput.value = -1; // Reset seleção
    const files = Array.from(event.target.files);

    files.forEach((file, index) => {
      if (file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = document.createElement('img');
          img.src = e.target.result;
          img.style.maxWidth = '100px';
          img.style.margin = '5px';
          img.style.cursor = 'pointer';
          img.style.border = '2px solid transparent';

          img.addEventListener('click', function() {
            // Remover borda de todas
            preview.querySelectorAll('img').forEach(i => i.style.border = '2px solid transparent');
            // Destacar clicada
            img.style.border = '2px solid red';
            // Guardar índice
            mainImageIndexInput.value = index;
          });

          preview.appendChild(img);
        };
        reader.readAsDataURL(file);
      }
    });
  });
</script>

</body>
</html>